<script>
    jQuery('#fb5').data('config', {
        "page_width":"550",
        "page_height":"715",
        "email_form":"office@somedomain.com",
        "zoom_double_click":"1",
        "zoom_step":"0.06",
        "double_click_enabled":"true",
        "tooltip_visible":"true",
        "toolbar_visible":"true",
        "gotopage_width":"30",
        "deeplinking_enabled":"true",
        "rtl":"false",
        'full_area':'true',
        'lazy_loading_thumbs':'false',
        'lazy_loading_pages':'false'
    });

$(function () {
    // Функция для обновления классов `active` на страницах
    function updateActivePagesFromHash() {
        const hash = window.location.hash.slice(1); // Убираем символ `#`
        const pageMatch = hash.match(/page(\d+)-page(\d+)/); // Ищем формат "pageX-pageY"

        // Удаляем класс `active` со всех страниц
        $('.turn-page-wrapper').removeClass('active');

        if (pageMatch) {
            const page1 = pageMatch[1]; // Первая страница
            const page2 = pageMatch[2]; // Вторая страница

            // Добавляем класс `active` для найденных страниц
            $(`.turn-page-wrapper[page="${page1}"]`).addClass('active');
            $(`.turn-page-wrapper[page="${page2}"]`).addClass('active');

            console.log(`Активные страницы: ${page1}, ${page2}`);
        } else {
            console.warn("Не удалось найти страницы в адресной строке.");
        }
    }

    // Функция для создания подсказок на основе активных страниц
    function generateHints() {
        const hints = [];
        $('.turn-page-wrapper.active').each(function () {
            $(this).find('[data-hint]').each(function () {
                hints.push({
                    element: this,
                    hint: $(this).attr('data-hint'),
                    hintPosition: $(this).attr('data-hintposition') || 'bottom-middle',
                    hintAnimation: true
                });
            });
        });

        return hints;
    }

    // Функция для запуска подсказок
    function activateHints() {
        const hints = generateHints();

        if (hints.length > 0) {
            console.log(`Создаём ${hints.length} подсказок для активных страниц.`);
            introJs().setOptions({
                hints: hints,
                hintButtonLabel: "OK",
                hintShowButton: true,
                hintAnimation: true
            }).addHints();
        } else {
            console.log("Нет подсказок для активных страниц.");
        }
    }

    // Функция для анимации изображений на активных страницах
    function animateImagesOnActivePages() {
        $('.turn-page-wrapper.active').each(function () {
            const $images = $(this).find('.fb5-cont-page-book img');
            $images.each(function (index, img) {
                $(img).css({
                    'opacity': 0,
                    'transition': 'opacity 1s ease-in',
                    'transition-delay': `${index * 0.5}s`
                });
                setTimeout(function () {
                    $(img).css('opacity', 1);
                }, index * 500);
            });
        });
    }

    // Функция для обработки изменения страницы
    function handlePageChange() {
        updateActivePagesFromHash(); // Обновляем классы `active` для страниц
        animateImagesOnActivePages(); // Анимация изображений
        introJs().hideHints(); // Скрываем все предыдущие подсказки
        activateHints(); // Генерируем и показываем подсказки для текущих страниц
    }

    // Слушатель изменений
    $(window).on("hashchange", function () {
        handlePageChange();
    });

    // Инициализация
    handlePageChange();
});

</script>