<script>
    jQuery('#fb5').data('config', {
        "page_width":"550",
        "page_height":"715",
        "email_form":"office@somedomain.com",
        "zoom_double_click":"1",
        "zoom_step":"0.06",
        "double_click_enabled":"true",
        "tooltip_visible":"true",
        "toolbar_visible":"true",
        "gotopage_width":"30",
        "deeplinking_enabled":"true",
        "rtl":"false",
        'full_area':'true',
        'lazy_loading_thumbs':'false',
        'lazy_loading_pages':'false'
    });

$(function () {
    // Обновляем активные страницы на основе хэша
    function updateActivePagesFromHash() {
        const hash = window.location.hash.slice(1); // Убираем #
        const pageMatch = hash.match(/page(\d+)-page(\d+)/); // Ищем формат "pageX-pageY"

        $('.turn-page-wrapper').removeClass('active'); // Удаляем старый класс

        if (pageMatch) {
            const page1 = pageMatch[1];
            const page2 = pageMatch[2];

            $(`.turn-page-wrapper[page="${page1}"]`).addClass('active');
            $(`.turn-page-wrapper[page="${page2}"]`).addClass('active');

            console.log(`Активные страницы: ${page1}, ${page2}`);
        } else {
            console.warn("Не удалось определить активные страницы из хэша.");
        }
    }

    // Удаляем текущие подсказки
    function removeHints() {
        $('.introjs-hint').remove(); // Удаляем точки подсказок
        $('.introjs-tooltip').remove(); // Удаляем активные тултипы
    }

    // Добавляем подсказки на активные страницы
    function addHintsToActivePages() {
        // Удаляем старые подсказки
        removeHints();

        // Находим все изображения на активных страницах
        const images = $('.turn-page-wrapper.active img');

        if (images.length === 0) {
            console.log("Нет изображений для добавления подсказок.");
            return;
        }

        // Создаём подсказки
        images.each(function (index) {
            const $img = $(this);
            const offset = $img.offset(); // Позиция изображения на странице

            // Создаём точку подсказки
            const hint = $('<div class="introjs-hint" style="position: absolute;"></div>');
            const dot = $('<div class="introjs-hint-dot"></div>');
            const pulse = $('<div class="introjs-hint-pulse"></div>');

            hint.append(dot).append(pulse);

            // Устанавливаем позицию подсказки
            hint.css({
                top: offset.top + $img.height() / 2 - 10, // Центр по высоте
                left: offset.left + $img.width() / 2 - 10 // Центр по ширине
            });

            // Добавляем событие для отображения тултипа
            hint.on('click', function () {
                // Удаляем старый тултип
                $('.introjs-tooltip').remove();

                // Создаём тултип
                const tooltip = $(`
                    <div class="introjs-tooltip" style="position: absolute;">
                        <div class="introjs-tooltiptext">test</div>
                        <button class="introjs-tooltipbutton">Got it</button>
                    </div>
                `);

                // Устанавливаем позицию тултипа
                tooltip.css({
                    top: offset.top + $img.height() + 10, // Сдвиг ниже изображения
                    left: offset.left // Выравнивание по левому краю изображения
                });

                // Удаляем тултип при клике на кнопку
                tooltip.find('.introjs-tooltipbutton').on('click', function () {
                    tooltip.remove();
                });

                $('body').append(tooltip); // Добавляем тултип на страницу
            });

            $('body').append(hint); // Добавляем точку подсказки на страницу
        });

        console.log(`Добавлено ${images.length} подсказок.`);
    }

    // Обрабатываем смену страницы
    function handlePageChange() {
        updateActivePagesFromHash(); // Обновляем активные страницы
        addHintsToActivePages(); // Добавляем подсказки для активных страниц
    }

    // Слушаем изменение хэша
    $(window).on("hashchange", function () {
        handlePageChange();
    });

    // Инициализация
    handlePageChange();
});

</script>